<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>æ³¨éŸ³ç¬¦è™Ÿç·´ç¿’éŠæˆ²</title>
<style>
  body {
    font-family:"Microsoft JhengHei", sans-serif;
    text-align:center;
    margin:20px;
  }
  h1 { font-size: clamp(28px, 6vw, 56px); margin-bottom: 10px; }
  #choices button {
    display:block;
    margin:5px auto;
    padding:10px 20px;
    font-size:24px;
    cursor:pointer;
  }
  #next-button, #restart-button {
    margin-top:20px;
    padding:10px 20px;
    font-size:20px;
    cursor:pointer;
  }
  #feedback { font-size: 22px; margin-top: 10px; min-height: 28px; }
</style>
</head>
<body>

<h1>æ³¨éŸ³ç¬¦è™Ÿç·´ç¿’éŠæˆ²</h1>

<div id="intro-container">
  <button id="start-button">é–‹å§‹éŠæˆ²</button>
</div>

<div id="game-container" style="display:none;">
  <p id="question-word"></p>
  <div id="choices"></div>
  <p id="feedback"></p>
  <button id="next-button" style="display:none;">ä¸‹ä¸€é¡Œ</button>
</div>

<script>
// ------------------------
// æ­£ç¢ºç­”æ¡ˆåˆ—è¡¨
const correctAnswers = [
  "ã„<br>ã„œËŠ<br><br>ã„‡<br>ã„šË‡",
  "ã„§<br>ã„ Ë‹<br><br>ã„‘<br>ã„©Ë‹",
  "ã„†<br>ã„ Ë‹<br><br>ã„—<br>ã„ Ë‡",
  "ã„…<br>ã„¢Ë‹<br><br>ã„Œ<br>ã„¨Ë‹",
  "ã„©Ë‹<br><br>ã„‰<br>ã„ Ë‹",
  "ã„<br>ã„œËŠ<br><br>ã„Œ<br>ã„§ËŠ",
  "ã„‡<br>ã„¤ËŠ<br><br>Ë™<br>ã„“<br>ã„œ",
  "ã„“<br>ã„¨ËŠ<br><br>ã„”<br>ã„ ËŠ",
  "ã„…<br>ã„›<br><br>ã„Œ<br>ã„§ËŠ",
  "ã„¨<br><br>ã„†<br>ã„›ËŠ",
  "ã„‡<br>ã„›Ë‡<br><br>ã„ˆ<br>ã„šË‡",
  "ã„¨<br>ã„›Ë‹<br><br>ã„ˆ<br>ã„¤ËŠ"
];

// æ³¨éŸ³ç¬¦è™Ÿæ›¿æ›è¦å‰‡ï¼ˆéŒ¯èª¤ç”Ÿæˆç”¨ï¼‰
const zhuyinSwap = {
  "ã„š":["ã„›","ã„œ"], "ã„›":["ã„š","ã„œ"], "ã„œ":["ã„š","ã„›"],
  "ã„§":["ã„©","ã„§Ë‹"], "ã„©":["ã„§","ã„©Ë‹"], "ã„§Ë‹":["ã„§","ã„©"],
  "ã„—":["ã„“"], "ã„“":["ã„—"],
  "ã„…":["ã„†"], "ã„†":["ã„…"],
  "ã„Œ":["ã„‰"], "ã„‰":["ã„Œ"],
  "ã„”":["ã„˜"], "ã„˜":["ã„”"]
};

// è‡ªå‹•ç”ŸæˆéŒ¯èª¤ç­”æ¡ˆå‡½å¼
function generateWrongAnswer(correct) {
  let parts = correct.split(/<br>/);
  let indexes = [];
  for (let i=0;i<parts.length;i++){
    if(zhuyinSwap[parts[i]]) indexes.push(i);
  }
  if(indexes.length===0) return correct;
  let idx = indexes[Math.floor(Math.random()*indexes.length)];
  let swaps = zhuyinSwap[parts[idx]];
  parts[idx] = swaps[Math.floor(Math.random()*swaps.length)];
  return parts.join("<br>");
}

// ç”Ÿæˆ questions é™£åˆ—
const questions = correctAnswers.map((ans,i)=>{
  const wrong = generateWrongAnswer(ans);
  const choices = Math.random()<0.5 ? [ans, wrong] : [wrong, ans];
  return { word:(i+1).toString(), choices:choices, answer:ans };
});

// ------------------------
// éŠæˆ²è®Šæ•¸
let shuffledIndexes = [];
let currentIndex = 0;
let correctCount = 0;
let wrongAnswers = [];

// æ´—ç‰Œå‡½å¼
function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

// å–å¾—å…ƒç´ 
const startBtn = document.getElementById("start-button");
const introContainer = document.getElementById("intro-container");
const gameContainer = document.getElementById("game-container");
const questionNumberEl = document.getElementById("question-word");
const choicesEl = document.getElementById("choices");
const feedbackEl = document.getElementById("feedback");
const nextBtn = document.getElementById("next-button");

// ------------------------
// é–‹å§‹éŠæˆ²
function startGame(){
  shuffledIndexes = shuffle([...Array(questions.length).keys()]);
  currentIndex = 0;
  correctCount = 0;
  wrongAnswers = [];
  feedbackEl.textContent = "";
  nextBtn.style.display = "none";
  showQuestion();
}

// é¡¯ç¤ºé¡Œç›®
function showQuestion(){
  feedbackEl.textContent = "";
  nextBtn.style.display = "none";
  const q = questions[shuffledIndexes[currentIndex]];
  questionNumberEl.textContent = `é¡Œç›®ï¼š${currentIndex+1}`;
  choicesEl.innerHTML = "";
  q.choices.forEach(choice=>{
    const btn = document.createElement("button");
    btn.innerHTML = choice;
    btn.className="choice-button";
    btn.onclick = ()=>checkAnswer(choice,q);
    choicesEl.appendChild(btn);
  });
}

// æª¢æŸ¥ç­”æ¡ˆ
function checkAnswer(selected,q){
  if(selected===q.answer){
    feedbackEl.textContent="âœ… ç­”å°äº†ï¼";
    feedbackEl.style.color="green";
    correctCount++;
  } else {
    feedbackEl.textContent=`âŒ éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${q.answer.replace(/<br>/g,'')}`;
    feedbackEl.style.color="red";
    wrongAnswers.push({word:q.word,correct:q.answer,selected:selected});
  }
  Array.from(choicesEl.children).forEach(btn=>btn.disabled=true);
  nextBtn.style.display="inline-block";
}

// ä¸‹ä¸€é¡Œ
nextBtn.onclick = ()=>{
  currentIndex++;
  if(currentIndex<questions.length){
    showQuestion();
  } else {
    showResult();
  }
}

// é¡¯ç¤ºçµæœ
function showResult(){
  questionNumberEl.textContent="";
  choicesEl.innerHTML="";
  nextBtn.style.display="none";
  let html = `
    <h2>ğŸ‰ éŠæˆ²å®Œæˆï¼</h2>
    <p>ç¸½å…± ${questions.length} é¡Œ</p>
    <p>âœ… ç­”å°ï¼š${correctCount} é¡Œ</p>
    <p>âŒ ç­”éŒ¯ï¼š${questions.length-correctCount} é¡Œ</p>
  `;
  if(wrongAnswers.length===0) html+=`<p>ğŸ¯ å®Œå…¨ç­”å°ï¼Œå¤ªå²å®³äº†ï¼</p>`;
  feedbackEl.innerHTML=html;
  restartBtn.style.display="inline
