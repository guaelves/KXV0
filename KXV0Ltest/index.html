<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>注音符號練習遊戲</title>
<style>
  body {
    font-family:"Microsoft JhengHei", sans-serif;
    text-align:center;
    margin:20px;
  }
  h1 { font-size: clamp(28px, 6vw, 56px); margin-bottom: 10px; }
  #choices button {
    display:block;
    margin:5px auto;
    padding:10px 20px;
    font-size:24px;
    cursor:pointer;
  }
  #next-button, #restart-button {
    margin-top:20px;
    padding:10px 20px;
    font-size:20px;
    cursor:pointer;
  }
  #feedback { font-size: 22px; margin-top: 10px; min-height: 28px; }
</style>
</head>
<body>

<h1>注音符號練習遊戲</h1>

<div id="intro-container">
  <button id="start-button">開始遊戲</button>
</div>

<div id="game-container" style="display:none;">
  <p id="question-word"></p>
  <div id="choices"></div>
  <p id="feedback"></p>
  <button id="next-button" style="display:none;">下一題</button>
</div>

<script>
// ------------------------
// 正確答案列表
const correctAnswers = [
  "ㄏ<br>ㄜˊ<br><br>ㄇ<br>ㄚˇ",
  "ㄧ<br>ㄠˋ<br><br>ㄑ<br>ㄩˋ",
  "ㄆ<br>ㄠˋ<br><br>ㄗ<br>ㄠˇ",
  "ㄅ<br>ㄢˋ<br><br>ㄌ<br>ㄨˋ",
  "ㄩˋ<br><br>ㄉ<br>ㄠˋ",
  "ㄏ<br>ㄜˊ<br><br>ㄌ<br>ㄧˊ",
  "ㄇ<br>ㄤˊ<br><br>˙<br>ㄓ<br>ㄜ",
  "ㄓ<br>ㄨˊ<br><br>ㄔ<br>ㄠˊ",
  "ㄅ<br>ㄛ<br><br>ㄌ<br>ㄧˊ",
  "ㄨ<br><br>ㄆ<br>ㄛˊ",
  "ㄇ<br>ㄛˇ<br><br>ㄈ<br>ㄚˇ",
  "ㄨ<br>ㄛˋ<br><br>ㄈ<br>ㄤˊ"
];

// 注音符號替換規則（錯誤生成用）
const zhuyinSwap = {
  "ㄚ":["ㄛ","ㄜ"], "ㄛ":["ㄚ","ㄜ"], "ㄜ":["ㄚ","ㄛ"],
  "ㄧ":["ㄩ","ㄧˋ"], "ㄩ":["ㄧ","ㄩˋ"], "ㄧˋ":["ㄧ","ㄩ"],
  "ㄗ":["ㄓ"], "ㄓ":["ㄗ"],
  "ㄅ":["ㄆ"], "ㄆ":["ㄅ"],
  "ㄌ":["ㄉ"], "ㄉ":["ㄌ"],
  "ㄔ":["ㄘ"], "ㄘ":["ㄔ"]
};

// 自動生成錯誤答案函式
function generateWrongAnswer(correct) {
  let parts = correct.split(/<br>/);
  let indexes = [];
  for (let i=0;i<parts.length;i++){
    if(zhuyinSwap[parts[i]]) indexes.push(i);
  }
  if(indexes.length===0) return correct;
  let idx = indexes[Math.floor(Math.random()*indexes.length)];
  let swaps = zhuyinSwap[parts[idx]];
  parts[idx] = swaps[Math.floor(Math.random()*swaps.length)];
  return parts.join("<br>");
}

// 生成 questions 陣列
const questions = correctAnswers.map((ans,i)=>{
  const wrong = generateWrongAnswer(ans);
  const choices = Math.random()<0.5 ? [ans, wrong] : [wrong, ans];
  return { word:(i+1).toString(), choices:choices, answer:ans };
});

// ------------------------
// 遊戲變數
let shuffledIndexes = [];
let currentIndex = 0;
let correctCount = 0;
let wrongAnswers = [];

// 洗牌函式
function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

// 取得元素
const startBtn = document.getElementById("start-button");
const introContainer = document.getElementById("intro-container");
const gameContainer = document.getElementById("game-container");
const questionNumberEl = document.getElementById("question-word");
const choicesEl = document.getElementById("choices");
const feedbackEl = document.getElementById("feedback");
const nextBtn = document.getElementById("next-button");

// ------------------------
// 開始遊戲
function startGame(){
  shuffledIndexes = shuffle([...Array(questions.length).keys()]);
  currentIndex = 0;
  correctCount = 0;
  wrongAnswers = [];
  feedbackEl.textContent = "";
  nextBtn.style.display = "none";
  showQuestion();
}

// 顯示題目
function showQuestion(){
  feedbackEl.textContent = "";
  nextBtn.style.display = "none";
  const q = questions[shuffledIndexes[currentIndex]];
  questionNumberEl.textContent = `題目：${currentIndex+1}`;
  choicesEl.innerHTML = "";
  q.choices.forEach(choice=>{
    const btn = document.createElement("button");
    btn.innerHTML = choice;
    btn.className="choice-button";
    btn.onclick = ()=>checkAnswer(choice,q);
    choicesEl.appendChild(btn);
  });
}

// 檢查答案
function checkAnswer(selected,q){
  if(selected===q.answer){
    feedbackEl.textContent="✅ 答對了！";
    feedbackEl.style.color="green";
    correctCount++;
  } else {
    feedbackEl.textContent=`❌ 錯了，正確答案是：${q.answer.replace(/<br>/g,'')}`;
    feedbackEl.style.color="red";
    wrongAnswers.push({word:q.word,correct:q.answer,selected:selected});
  }
  Array.from(choicesEl.children).forEach(btn=>btn.disabled=true);
  nextBtn.style.display="inline-block";
}

// 下一題
nextBtn.onclick = ()=>{
  currentIndex++;
  if(currentIndex<questions.length){
    showQuestion();
  } else {
    showResult();
  }
}

// 顯示結果
function showResult(){
  questionNumberEl.textContent="";
  choicesEl.innerHTML="";
  nextBtn.style.display="none";
  let html = `
    <h2>🎉 遊戲完成！</h2>
    <p>總共 ${questions.length} 題</p>
    <p>✅ 答對：${correctCount} 題</p>
    <p>❌ 答錯：${questions.length-correctCount} 題</p>
  `;
  if(wrongAnswers.length===0) html+=`<p>🎯 完全答對，太厲害了！</p>`;
  feedbackEl.innerHTML=html;
  restartBtn.style.display="inline
